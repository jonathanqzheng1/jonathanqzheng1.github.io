<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Idiom Translation Annotation Tutorial</title>
    <script src="https://code.jquery.com/jquery-3.5.1.js"
        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://unpkg.com/vue-form-wizard/dist/vue-form-wizard.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.10/vue.min.js"></script>
    <script src="https://kit.fontawesome.com/c3b36ffc0c.js" crossorigin="anonymous"></script>

    <script src="../js/leader-line.min.js"></script>

    <!-- <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore-compat.js"></script> -->

    <link rel="stylesheet" href="https://unpkg.com/vue-form-wizard/dist/vue-form-wizard.min.css">
    <link rel="stylesheet" href="https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/selection.css">
    <link rel="stylesheet" href="../css/button.css">
    <link rel="stylesheet" href="../css/select_box.css">
    <link rel="stylesheet" href="../css/qual.css">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
</head>

<!-- https://github.com/BinarCode/vue-form-wizard/issues/27 -->

<body class="sans-serif">
    <div id="app">
        <form-wizard 
            :hide-buttons="true" 
            @on-complete="onComplete" 
            @on-change="onChange" 
            next-button-text="Next" 
            back-button-text="Back" 
            finish-button-text="Finish"
            title="Neologism Translation Annotation Main Study"
            ref="wizard"
            subtitle="">
            
            <tab-content title="Introduction">
                <h1>Introduction</h1>
                <p>
                    Welcome to the neologism translation annotation.
                </p>

                <p>
                    You are selected for because of the similarity to the idiom translation annotation study you did. 
                </p>

                <h2>Overview</h2>

                <ul>
                    <li>
                        The main study contains batches of translation pairs. 
                        We will release each series one by one. This is the first series of studies.
                    </li>
                    <li>
                        There are 4 batches of translation pairs and you need to finish annotating all of them. 
                        In other words, you need to submit 4 times on 4 different Thresh pages.
                    </li>
                </ul>


            </tab-content>

            <tab-content title="Prolific Information">
                
                <div class="container card mb-3 card-body" id="bodyDemographics">
                    <p class="mt0 f2 b">Prolific Information</p>
  
                    <p class="f4">
                        This page pre-fills your Prolific information, 
                        including Prolific ID, Study ID and Session ID.
                    </p>
                    
                    <ul >
                        <li style="margin: 10px 0">
                            Prolific ID:  <input id='pro-id-input' type="text" name="prolific-id" size="30" readonly>
                        </li>
                        <li style="margin: 10px 0">
                            Study ID:  <input id='sty-id-input' type="text" name="study-id" size="30" readonly>
                        </li>
                        <li style="margin: 10px 0">
                            Session ID:  <input id='ses-id-input' type="text" name="sessionn-id" size="30" readonly>
                        </li>
                        
                    </ul>


                </div>
            </tab-content>


            <tab-content title="Main Study Part 1">
                
                <p>
                    Let's now do the actual study. The study will be open in a new tab after you click the link below.
                    In the end, click <i>Submit</i> button to submit your annotations. 
                </p>
                <p>
                    After submission, you will be redirected to prolific with a completion code.
                </p>
                <p>
                    <b>Note: this is part 1 out of 3 for the current series! You need to come back to resume after submission.</b>
                </p>

                <a target="_blank" id="main_study_p1">Click to start your part 1 annotation!</a> 
                
            </tab-content>

            <tab-content title="Main Study Part 2">

                <b>Note: this is part 2 out of 2 for the current series!</b>

                <br><br>

                <a target="_blank" id="main_study_p2">Click to start your part 2 annotation!</a> 
                
            </tab-content>



            <tab-content title="Optional Feedback">
                <div class="container card mb-3 card-body" id="bodyFeedback">
  
                    <!--Motivation text -->
                    <p class="mt0 f2 b">Optional Feedback</p>

                    <p class=" lh-copy f4">
                        If you have any feedback about improving this task, you can let
                        us know here! Completely optional / not required.
                    </p>
                    <textarea id="feedback" name="feedback" class="mf-textarea" rows="5" cols="90"></textarea>

                    <button class="button button3" id="firestore_submit_single" style="margin: 10px 0; float: right">
                        Submit your feedback
                    </button>


                </div>

            </tab-content>


        </form-wizard>
    </div>

</body>
<script src="../js/qual.js"></script>


<script>
    function myFunction() {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const prolific_id = urlParams.get('PROLIFIC_PID');
        const study_id = urlParams.get('STUDY_ID');
        const session_id = urlParams.get('SESSION_ID');
        document.getElementById("pro-id-input").value = prolific_id;
        document.getElementById("sty-id-input").value = study_id;
        document.getElementById("ses-id-input").value = session_id;
    };
    window.onload = myFunction;
</script>

<script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const prolific_id = urlParams.get('PROLIFIC_PID');
    const study_id = urlParams.get('STUDY_ID');
    const session_id = urlParams.get('SESSION_ID');

    var p1 = "", p2 = "", p3 = "";
    
    if (prolific_id == '615d051e2366aeb051acb734'){
        p1 = "0", p2 = "5", p3 = "10";
    }else if (prolific_id == '651b29ff3a6cadf518640abe'){
        p1 = "1", p2 = "6", p3 = "11";
    }else if (prolific_id == '5d8cb1c93a7d5c00196eae92'){
        p1 = "2", p2 = "7", p3 = "12";
    }else if (prolific_id == '5d384c97285d1400199a2886'){
        p1 = "3", p2 = "8", p3 = "13";
    }else if (prolific_id == '5faefcc22be93b11829e84df'){
        p1 = "4", p2 = "9", p3 = "14";
    }

    let main_url_1 = "https://thresh.tools/?gh=JonathanQZheng/MTTranslationAnnotation/main/interface.yml&d=caiyangcy/idiom-annotation/master/sub-batches-1/round_0/" + prolific_id +
                     "/sub_batch_" + p1 + ".json" + "&PROLIFIC_PID=" + prolific_id + "&STUDY_ID=" + study_id + "&SESSION_ID=" + session_id;
       
    let main_url_2 = "https://thresh.tools/?gh=JonathanQZheng/MTTranslationAnnotation/main/interface.yml&&d=caiyangcy/idiom-annotation/master/sub-batches-1/round_0/" + prolific_id +
                     "/sub_batch_" + p2 + ".json" + "&PROLIFIC_PID=" + prolific_id + "&STUDY_ID=" + study_id + "&SESSION_ID=" + session_id

    
    let main_study_p1 = document.getElementById("main_study_p1");
    main_study_p1.href = main_url_1;

    let main_study_p2 = document.getElementById("main_study_p2");
    main_study_p2.href = main_url_2;

</script>

<style>
    .button {
      background-color: #4CAF50; /* Green */
      border: none;
      color: white;
      padding: 16px 32px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      transition-duration: 0.4s;
      cursor: pointer;
    }
    
    .button3 {
      background-color: white; 
      color: black; 
      border: 2px solid #d65745;
      border-radius: 12px
    }
    
    .button3:hover {
      background-color: #d65745;
      color: white;
      border-radius: 12px
    }

</style>


<script type="module">
    // Import the functions you need from the SDKs you need
    // import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
    import { getDatabase, ref, set, push, child } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-database.js";
    import { getFirestore, collection, addDoc, doc, setDoc, updateDoc, arrayUnion, getDoc } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDypURj3AXUFVjlxtyu0w0u-RSGWRZCv-U",
        authDomain: "idiom-403314.firebaseapp.com",
        projectId: "idiom-403314",
        storageBucket: "idiom-403314.appspot.com",
        messagingSenderId: "373788045145",
        appId: "1:373788045145:web:3f76689c6ef3a636dba648",
        measurementId: "G-ELNHFK5CZ2"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const could_firestore = getFirestore(app);
    const realtime_db = getDatabase(app);


    firestore_submit_single.addEventListener("click", (e) => {

        const prolific_id = document.getElementById("pro-id-input").value
        
        setDoc(doc(could_firestore, "Users", prolific_id), {
            prolific_id: prolific_id,
            study_id: document.getElementById("sty-id-input").value,
            session_id: document.getElementById("ses-id-input").value,
            feedback: document.getElementById("feedback").value,
        }).then(() => {
            alert("The data annotation has been submitted. Now you can close the window. Thank you for your participation!");
        })
        .catch((error) => {
            alert("Error occurred");
        });

    });

</script>

</html>
